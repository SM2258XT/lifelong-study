---
title: 类加载子系统
updated: 2022-09-13T11:03:24
created: 2022-05-03T15:12:43
---

![](C:\Users\82609\AppData\Local\Temp\Java\pandoc/media/image1.png)
类加载器子系统作用：
1.  类加载器子系统负责从文件系统或者网络中加载Class文件，class文件在文件开头有特定的文件标识。
2.  ClassLoader只负责class文件的加载，至于它是否可以运行，则由Execution Engine决定。
3.  加载的类信息存放于一块称为方法区的内存空间。
除了**类信息**外，方法区中还会存放**运行时常量池**信息，可能还包括字符串字面量和数字常量（这部分常量信息是Class文件中常量池部分的内存映射）

执行 main() 方法就需要先加载main方法所在类 HelloLoader
**加载（3层加载器） -\> 链接（验证+准备+解析） -\> 初始化**。完成后调用类中的静态方法main。加载失败则抛出异常。

1.  加载：
通过一个类的全限定名获取定义此类的二进制字节流，将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构，在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的访问入口
1.  链接：
    1.  验证
目的在于确保Class文件的字节流中包含信息符合当前虚拟机要求，保证被加载类的正确性，不会危害虚拟机自身安全。主要包括四种验证，文件格式验证，元数据验证，字节码验证，符号引用验证。

比如使用 BinaryViewer软件查看JAVA编译的字节码文件，其开头均为 CAFE BABE
1.  准备
为类变量（static变量）**分配内存**并且设置该类变量的**默认初始值**，即**零值**

这里不包含用final修饰的static，因为final在编译的时候就会分配好了默认值，准备阶段会显式初始化

注意：这里不会为实例变量分配初始化，类变量会分配在方法区中，而实例变量是会随着对象一起分配到Java堆中
1.  解析
将常量池内的符号引用转换为直接引用的过程。解析操作往往会伴随着JVM在执行完初始化之后再执行

符号引用就是一组符号来描述所引用的目标。符号引用的字面量形式明确定义在《java虚拟机规范》的class文件格式中。直接引用就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄

解析动作主要针对类或接口、字段、类方法、接口方法、方法类型等。对应常量池中的CONSTANT Class info、CONSTANT Fieldref info、CONSTANT Methodref info等
1.  初始化：
**除了以下七种情况**，**其他**使用Java类的方式都被看作是对类的被动使用，都**不会**导致类的初始化，即**不会**调用 \<init() \>和\<clinit() \>
1.  创建类的实例
2.  访问某个类或接口的静态变量，或者对该静态变量赋值
3.  调用类的静态方法
4.  反射：Class.forName(“com.atguigu.Test”)
5.  初始化一个类的子类
6.  Java虚拟机启动时被标明为启动类的类
7.  JDK7开始提供的动态语言支持：java.lang.invoke.MethodHandle实例的解析结果REF_getStatic、REF putStatic、REF_invokeStatic句柄对应的类没有初始化，则初始化
**变量初始化时机**
static final：编译期
static：类加载子系统.2链接.2准备
成员：

|  |  |  |  |  |
|----|----|----|----|----|
|  | 初始化时机 | 位置 |  | 额外 |
| static final | 编译期 | 方法区 |  |  |
| static | 类加载子系统.2链接.2准备 |  |  | 仅是零值初始化。赋值动作在3初始化阶段 |
| 成员 | 对象创建时 | 堆 |  |  |
|  |  |  |  |  |
