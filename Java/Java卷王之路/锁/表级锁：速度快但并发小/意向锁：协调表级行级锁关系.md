---
title: 意向锁：协调表级行级锁关系
updated: 2023-03-05T09:23:14
created: 2022-10-17T10:13:17
---

**概念：**意向锁的存在是为了协调表级锁与行级锁的关系，支持多粒度锁共存。是一种不与行级锁冲突的表级锁。
其中又可以继续分为：
1.  意向共享锁（IS），也叫意向读锁。
2.  意向排他锁（IX），意向写锁。

**特性：**想要获取表级锁，只需**检查**意向锁。想要获取行级锁，必须先**获取**意向锁。
衍生出更细粒度的规则：想要获取行读锁，必须先获取意向读锁IS。

**理解：**
想要获取表（读写）锁，肯定得保证表中没有任何数据正在操作中吧！所以要确认一下所有记录此时都不应该存在行锁。
而这个确认的过程，曾经只能扫描全表逐个遍历。
如今引入意向锁，标志着当前表中，是否有事务已经或准备持有行锁。
这样就只用根据意向锁，判断一次就行了，而不是逐个遍历查询行锁。

**兼容性：只和表锁互斥**
意向锁不会与行级锁互斥，不会影响行级锁的并发性。

如果事务想要获得数据表中某些记录的行级共享锁，就需要在数据表上添加 IS。
如果事务想要获得数据表中某些记录的行级排他锁，就需要在数据表上添加 IX。
**特别注意：申请表级锁**的时候才会检查意向锁，而申请行记录则不影响（因为不同行锁本来就不互斥，意向锁不会与行级的共享/排他锁互斥）

**疑问：**意向锁是可重入锁吗？因为不同记录行锁肯定可以并行获取吧，那么意向锁就应该是可重入的？
