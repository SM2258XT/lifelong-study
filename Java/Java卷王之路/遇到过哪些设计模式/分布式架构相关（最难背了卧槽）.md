---
title: 分布式架构相关（最难背了卧槽）
updated: 2022-11-12T08:27:36
created: 2022-11-10T13:06:48
---

**整个系统的接口幂等性**
1.  数据库（不推荐）
    1.  唯一主键
    2.  增加版本号字段，实现乐观锁。
2.  MQ避免重复消费
3.  使用token
    1.  前端请求时顺带发个token并存到redis，用户下单重复提交时携带token，首次在redis中删除token，后面重复的token因为查不到就判定失效
4.  分布式锁

**缓存双写一致性**
双写，指的是数据库和Redis缓存双写
1.  [延时双删、串行化](onenote:#保证双写一致性&section-id={CDD07D22-AD2B-45C8-A76D-8BE3375113E8}&page-id={70954214-DEB7-4751-9657-FD8DFC2EBF5E}&end&base-path=https://d.docs.live.net/36a2ce0fd7a6557d/文档/Java/Java卷王之路.one)
注意，这里可以先说：先删库在删缓存，然后在引出不足，再改为先删缓存
如果延时双删失败了，则：
1.  MQ重试删除
如果缓存删除失败，还可以给MQ发一条重试删除消息

