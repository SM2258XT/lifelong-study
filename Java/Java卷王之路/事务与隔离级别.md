---
title: 事务与隔离级别
updated: 2024-09-11T10:55:50
created: 2022-05-13T20:50:44
---

**事务原则：ACID**
1.  原子性（Atomicity）
原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。
1.  一致性（Consistency）
事务前后数据的完整性必须保持一致。
1.  隔离性（Isolation）
事务的隔离性是多个用户并发访问数据库时，数据库为每一个用户开启的事务，不能被其他事务的操作数据所干扰，多个并发事务之间要相互隔离。
1.  持久性（Durability）
持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响

**事务并发导致的问题**
1.  脏读：指一个事务读取了另外一个事务未提交的数据。和回滚有关。
2.  不可重复读（物是人非）：在一个事务内读取表中的某一行数据，多次读取结果不同。仅是update
3.  幻读（无中生有）：在一个事务内读取到了别的事务插入的数据，导致前后读取数量总量不一致。仅是insert/delete

**不可重复读和幻读的根本区别在于：普通锁能否解决**
不可重复读（update、delete）：可以通过锁住数据，不让别的事务更改，进而避免并发问题，容易实现。
但是幻读（insert）**普通锁根本锁不住**！因为还没insert之前，怎么锁住未来即将insert的数据？
因此，对于未来insert锁不住的问题，只有RR级别下的Next-key Lock才能解决

**事务隔离级别：保证并发数据的正确性**
1.  读未提交**RU**：脏读
其他事务还没提交，自己就读取到了临时的数据。对方要是回滚了，自己就读了个错的临时脏数据。

查询不会加锁，一致性最差，会产生脏读、不可重复读、幻读的问题
1.  读已提交**RC**：不可重复读
其他事务提交了之后，自己才能读到；每读到的都是最新数据，不能重复读取到之前的数据

该隔离级别避免了脏读问题的产生，但是不可重复读和幻读的问题仍然存在；

读提交事务隔离级别是大多数流行数据库的默认事务隔离级别，比如 Oracle，但是不是 MySQL 的默认隔离界别
1.  可重复读**RR**：幻读
事务在执行过程中可以读取到其他事务已提交的新插入的数据，但是不能读取其他事务对数据的修改，也就是说多次读取同一记录的结果相同；该个里级别避免了脏读、不可重复度的问题，但是仍然无法避免幻读的问题

可重复读是MySQL默认的隔离级别
1.  串行化：事务串行化执行，事务只能一个接着一个地执行，并且在执行过程中完全看不到其他事务对数据所做的更新；缺点是并发能力差，最严格的事务隔离，完全符合ACID原则，但是对性能影响比较大
![](C:\Users\82609\AppData\Local\Temp\Java\pandoc/media/image1.png)
