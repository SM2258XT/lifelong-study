---
title: 过期策略
updated: 2022-10-15T08:38:15
created: 2022-10-14T16:44:31
---

过期策略：什么时候清理已经过期的数据

淘汰策略：内存不足时，如何存储新的数据

**前提：设置过期时间**
1.  Expire、PExpire：设置过期剩余时间为ttl秒或毫秒
2.  ExpireAt、PExpireAt：设置过期时间点为timestamp所代表的秒或毫秒
其他操作：Persist（移除过期时间）、TTL（查看过期时间）

**三种 过期处理策略**

注意，这里是针对已经设置了过期时间的key来说的。（因为没设置就不会过期）
1.  定时过期：
每个key都追加一个定时器，到期立即删除。

优点：省内存

缺点：消耗CPU资源
1.  **惰性过期：**
只有访问时，才去判断是否过期并清除。

优点：省CPU

缺点：耗内存，极端情况出现大量过期key，但由于没被访问而无法清除，空占内存。
1.  **定期过期：（折中方案）**
每隔一段时间，扫描并清除过期key

Redis同时使用的是惰性和定期过期

**两种 业务层面过期怎么处理（附加的过期处理策略）**

理解：数据实际ttl没过期，但是在业务逻辑上，可能该数据不再是热点数据，或者数据库更新后缓存就过期失效了，必须再次更新。
1.  定期清理逻辑过期缓存。
2.  用户请求来时在判断是否过期，并更新。

**总结：过期策略 3 + 2**
