---
title: 慢查询优化步骤
updated: 2022-11-22T15:04:08
created: 2022-11-22T14:55:27
---

慢查询优化步骤
<https://tech.meituan.com/2014/06/30/mysql-index.html>
2022年11月22日
14:55

1.  先运行看看是否真的很慢，注意设置SQL_NO_CACHE
2.  where条件单表查，锁定最小返回记录表。这句话的意思是把查询语句的where都应用到表中返回的记录数最小的表开始查起，单表每个字段分别查询，看哪个字段的区分度最高
3.  explain查看执行计划，是否与1预期一致（从锁定记录较少的表开始查询）
4.  order by limit 形式的sql语句让排序的表优先查
5.  了解业务方使用场景
6.  加索引时参照建索引的几大原则
7.  观察结果，不符合预期继续从0分析

慢查询的案例就分析到这儿，以上只是一些比较典型的案例。我们在优化过程中遇到过超过1000行，涉及到16个表join的“垃圾SQL”，也遇到过线上线下数据库差异导致应用直接被慢查询拖死，也遇到过varchar等值比较没有写单引号，还遇到过笛卡尔积查询直接把从库搞死。再多的案例其实也只是一些经验的积累，如果我们熟悉查询优化器、索引的内部原理，那么分析这些案例就变得特别简单了。
