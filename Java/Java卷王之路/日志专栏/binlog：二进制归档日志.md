---
title: binlog：二进制归档日志
updated: 2022-11-02T14:58:20
created: 2022-11-02T13:49:11
---

**概述**
因为是归档，所以会记录所有**修改**操作，包括DDL和DML，而不会记录DQL
作用：数据恢复、主从复制
开启：
5.X默认没有开，需要在my.cnf配置中开启

log_bin=mysqlbin \# 配置开启binlog日志， 日志的文件前缀为 mysqlbin -----\> 生成的文件名如: mysqlbin.000001

binlog_format=STATEMENT

\# 配置二进制日志的格式。可以为STATEMENT（仅记录SQL）、ROW（记录每一行的数据变更情况，占空间多）、MIXED（默认，混合前两种）

**日志刷盘**
1.  写到Binlog Cahae缓存
2.  从缓存写到binlog文件，由fsync执行
fsync写到文件，并清空缓存

一个事务的binlog不能被拆开，所以无论当前事务多大，也要保证一次性写入
写缓存和写磁盘的时机控制：sync_binlog=0（只write）、1（write+fsync）、666（每次write，但积累N个后才fsync）

**日志读取、删除等**（待更新）

**数据恢复等**
误删库或表时，需要根据binlog进行数据恢复
一般情况下数据库有定时的全量备份，假如每天 0 点定时备份，12 点误删了库，恢复流程：
1.  取最近一次全量备份，用备份恢复出一个临时库
2.  从日志文件中取出凌晨 0 点之后的日志
3.  把除了误删除数据的语句外日志，全部应用到临时库

