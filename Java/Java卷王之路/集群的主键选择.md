---
title: 集群的主键选择
updated: 2022-10-19T09:26:31
created: 2022-10-14T11:44:06
---

**前情回顾：**[几种主键策略（挖坟）](onenote:Mybatis^MPlus.one#主键策略详解&section-id={E91B3D91-FECD-4A2C-961A-803D432535F1}&page-id={D6035B9F-CF3B-4A63-8CA8-9EE26289DB24}&end&base-path=https://d.docs.live.net/36a2ce0fd7a6557d/文档/Java)

**结论：推荐使用SnowFlake**
优点（主要是针对其他策略来比较的）：
1.  自增，有序性
主键效率高
缺点：
1.  时间回拨，可能出现 ID 重复，因为 ID 其中的几位是时间戳。（例如时钟同步）

**不要使用主键自增**
注意：设置了主键自增，只可能是范围分片，因为是数据库自己生成主键的。（hash分片需要依靠中间件？）
缺点：
1.  必须提前规划好分片。
评估好每个数据库最多可以承受多少数据。
1.  尾部热点效应。
数据尾部的那个分片库，压力会比其他库大很多，因为几乎承担了所有的insert操作。

**不要使用UUID**
缺点：
1.  主键索引效率极差
    1.  B+Tree非叶子节点会变得很胖（因为UUID 128位较长），导致该节点存储的主键数量变少，整棵树变高，增加 IO 次数。
    2.  UUID无序性，导致主键大量重排序。
