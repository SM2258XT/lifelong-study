---
title: 确保发送成功
updated: 2022-10-03T16:06:36
created: 2022-10-03T15:59:21
---

RabbitMQ 使用发送方确认模式（Confirm），确保消息正确地发送到 RabbitMQ。

**发送方确认模式：**
将信道设置成 Confirm 模式（发送方确认模式），则所有在信道上发布的消息都会被指派一个唯一的 ID 。
一旦消息被投递到目的队列后，或者消息被写入磁盘后（可持久化的消息），信道会返回一个确认给生产者（包含消息唯一ID）。
如果 RabbitMQ 发生内部错误从而导致消息丢失，会返回一条 nack（not acknowledged，未确认）消息。

**发送方确认消息可以异步处理**
Broker返回消息**一定是异步的**！只是发送者可以选择是否阻塞等待这个异步消息发给自己。
同步Confirm：选择阻塞，直到Broker返回消息。期间不做其他事，一直等
异步Confirm：使用回调函数，Broker返回时触发。期间继续正常发其他消息

