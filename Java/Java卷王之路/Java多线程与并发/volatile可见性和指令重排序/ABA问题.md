---
title: ABA问题
updated: 2022-09-15T14:17:17
created: 2022-05-02T10:53:29
---

即使使用了CAS + volatile，也可能出现问题
1.  有两个线程同时去修改一个变量的值，比如线程1、线程2，都更新变量值，将变量值从A更新成B。
2.  首先线程1获取到CPU的时间片，线程2由于某些原因发生阻塞进行等待，此时线程1进行比较更新（CompareAndSwap），成功将变量的值从A更新成B。
3.  更新完毕之后，恰好又有线程3进来想要把变量的值从B更新成A，线程3进行比较更新，成功将变量的值从B更新成A。
4.  线程2获取到CPU的时间片，然后进行比较更新，发现值是预期的A，然后有更新成了B。但是线程1并不知道，该值已经有了A-\>B-\>A这个过程，
这也就是我们常说的ABA问题：虽然结果还是一样，但是**中间过程被篡改了**，并不知晓。

有些业务如果不关心中间过程只要前后值一样就行，那么ABA问题几乎没有影响；但是有些业务需要变量在中间过程不能改变！

解决：
1.  可以通过加版本号或者加时间戳解决
2.  保证单向递增递减就不会存在此类问题。
