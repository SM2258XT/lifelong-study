---
title: 三种分布式锁
updated: 2022-10-27T14:06:49
created: 2022-10-12T15:25:09
---

三种分布式锁
分布式锁面试题 <https://blog.csdn.net/qq_35620342/article/details/119596776>
2022年10月12日
15:25

**分布式锁应该具备哪些条件：**
1.  在分布式系统环境下，一个方法在同一时间只能被一个机器的一个线程执行；
2.  高可用且高性能的获取锁与释放锁；
3.  具备可重入性；
4.  具备锁失效机制，防止死锁；
5.  具备非阻塞锁特性，即没有获取到锁将直接返回获取锁失败，而不是一直等待直到获取锁。

**分布式锁实现的三种方式：**
1.  **数据库**
实际是数据库锁实现的，用的还是少。

缺点：没有失效时间（可用定时任务解决）、非重入锁（额外加信息字段实现重入）、非阻塞（可用自旋解决）、严重依赖数据库可用性。
1.  **缓存Redis**
主要有三种方式：
1.  原始SET NX
不可重入

分布式集群为主从同步时，不太行（因为异步复制而不是同步复制）
1.  RedissonLock，集群不用再主从了，直接分片，锁完全由客户端来瞎操作实现。
2.  RedLock
使用的是hset col k v（不怕麻烦也可以使用普通set k v，这里的k是UUID，V是）

注意1：Redission也可以用RedLock，这个只是一个算法，需要实现者

注意2：只能有**多个主库**！！！不能主从集群，也不能Cluster，它就只是孤零零的多个节点实例

缺点：在主从结构中，master往slave同步锁信息时挂了，此时slave就会显示该锁没有被占用
1.  **注册中心Zookeeper**
主要使用临时顺序节点

**三种方案比较：**

从理解的难易程度角度（从低到高）：数据库 \> 缓存 \> Zookeeper

从实现的复杂性角度（从低到高）：Zookeeper \>= 缓存 \> 数据库

从性能角度（从高到低）：缓存 \> Zookeeper \>= 数据库

从可靠性角度（从高到低）：Zookeeper \> 缓存 \> 数据库

![](C:\Users\82609\AppData\Local\Temp\Java\pandoc/media/image1.png)
