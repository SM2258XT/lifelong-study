---
title: 锁失效场景
updated: 2022-10-27T12:43:04
created: 2022-10-27T12:34:04
---

1.  本地锁
2.  Mysql RR下的事务
因为默认隔离级别是RR，为了防止脏读，当线程A更新但未提交时，线程B只能快照读，读到的就是A更改之前的原始值。

注意：虽然有A正在事务，但是B还是可以读啊！复习一下MVCC。

勉强解决：保证锁比事务先执行，将事务全部放在锁范围内。但是实现还是麻烦，因为Spring声明式注解事务是AOP实现的，范围肯定比业务代码广。
1.  集群部署
