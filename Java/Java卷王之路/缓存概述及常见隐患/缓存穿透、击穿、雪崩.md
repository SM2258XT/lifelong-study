---
title: 缓存穿透、击穿、雪崩
updated: 2022-10-31T08:09:42
created: 2022-01-22T15:47:38
---

1.  **缓存穿透：查空数据**
对于缓存和数据库中都没有的数据，不断收到请求，导致数据库压力过大。如：发起为id为“-1”的数据或id为特别大不存在的数据。

解决方案：**缓存空结果、布隆过滤器**
1.  接口层增加校验，如布隆过滤器、用户鉴权校验、id \> 0基础校验；
2.  从缓存取不到的数据，在数据库中也没有取到，这时也可以将key-value对写为key-null，缓存有效时间可以设置短点，如30秒（设置太长会导致正常情况也没法使用）。这样可以防止攻击用户反复用同一个id暴力攻击。
1.  **缓存击穿：单条数据过期瞬间高并发查询**
缓存没有但数据库有的数据（一般是缓存时间到期），这时由于并发用户特别多，大量请求同时读缓存没读到数据，于是大量请求同时去数据库去取数据，引起数据库压力瞬间增大，造成过大压力。

注意：强调高并发查询同一条数据。

解决方案：**加锁查询**
1.  设置热点数据永远不过期。
2.  使用互斥锁，限制去数据库的访问量。
1.  **缓存雪崩：大面积同时过期**（要是此时每条过期的数据还恰巧瞬间高并发那也太惨了）
缓存中大批量数据同时过期，造成同时正常查询的数据量巨大，引起数据库压力过大。

注意：强调高并发同时查询多个同时过期的数据。

解决方案：**随机过期**
1.  缓存数据的过期时间设置随机，防止同一时间大量数据过期现象发生。
2.  如果缓存数据库是分布式部署，将热点数据均匀分布在不同搞得缓存数据库中。
3.  设置热点数据永远不过期。
4.  数据预热。正式开放之前，随机预访问一遍数据。

**击穿和雪崩区别：**

击穿是单条高并发，总条数少。单个的威力很大。

雪崩是单条不知道，总条数多。威力小但是数量多总量非常大。
