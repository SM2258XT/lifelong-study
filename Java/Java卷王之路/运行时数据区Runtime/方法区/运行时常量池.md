---
title: '* 运行时常量池'
updated: 2022-09-13T16:53:12
created: 2022-05-07T08:24:00
---

\* 运行时常量池
2022年5月7日
8:24

常量池表（Constant Pool Table）是**Class字节码文件**的一部分，用于存放编译期生成的各种字面量与符号引用。
运行时常量池（Runtime Constant Pool）是**方法区**的一部分。（运行时常量池就是常量池在程序运行时的称呼）

1.  常量池
可以看做是一张表，虚拟机指令根据这张常量表找到要执行的类名、方法名、参数类型、字面量等类型。
1.  为什么需要常量池？
一个java源文件中的类、接口，编译后产生一个字节码文件。而Java中的字节码需要数据支持，通常这种数据会很大以至于不能直接存到字节码里，换另一种方式，可以存到常量池。这个字节码包含了指向常量池的引用。在动态链接的时候会用到运行时常量池

即使只有一个输出语句，但是里面却使用了String、System、PrintStream及Object等结构。又比如说我们这个文件中有6个地方用到了"hello"这个字符串，如果不用常量池，就需要在6个地方全写一遍，造成臃肿。我们可以将"hello"等所需用到的结构信息记录在常量池中，并**通过引用**的方式，来加载、调用所需的结构
1.  常量池中有啥？
    1.  数量值
    2.  字符串值
    3.  类引用
    4.  字段引用
    5.  方法引用
1.  运行时常量池
    1.  在加载类和接口到虚拟机后，就会创建对应的运行时常量池。
    2.  JVM为每个已加载的类型（类或接口）都维护一个常量池。池中的数据项像数组项一样，是通过索引访问的。
    3.  运行时常量池中包含多种不同的常量，包括编译期就已经明确的数值字面量
也包括到运行期解析后才能够获得的方法或者字段**引用**。此时不再是常量池中的符号地址了，这里**换为真实地址**。
1.  运行时常量池类似于传统编程语言中的符号表（symbol table），但是它所包含的数据却比符号表要更加丰富一些。
2.  当创建类或接口的运行时常量池时，如果构造运行时常量池所需的内存空间超过了方法区所能提供的最大值，则JVM会抛OutofMemoryError异常。

