---
title: æ‰¹é‡å‘é€æ¶ˆæ¯
updated: 2022-10-02T14:49:56
created: 2022-10-02T10:41:12
---

RabbitMQæ²¡æœ‰RocketMQé‚£ç§æ‰¹é‡æ”¶å‘çš„APIï¼Œå› æ­¤æ‰¹é‡åŠŸèƒ½æ˜¯ä¾é Spring-AMQPæä¾›çš„MessageBatchæ¶ˆæ¯æ”¶é›†å™¨æ¥æ¨¡æ‹Ÿå®ç°ï¼Œå°†å‘é€ç»™ç›¸åŒ Exchange + RoutingKey çš„æ¶ˆæ¯ä»¬ï¼Œâ€œå·å·â€æ”¶é›†åœ¨ä¸€èµ·ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶å€™ï¼Œä¸€æ¬¡æ€§æ‰¹é‡å‘é€æäº¤ç»™ RabbitMQ Brokerã€‚
æ³¨æ„ï¼Œæ‰¹é‡å‘é€æ—¶ï¼ŒRabbitMQæ”¶åˆ°çš„åªæ˜¯ä¸€æ¡éå¸¸å¤§çš„æ™®é€šæ¶ˆæ¯ã€‚å› æ­¤æ¶ˆè´¹æ—¶ï¼Œæ¶ˆè´¹è€…å¿…é¡»å°†è¯¥æ¡éå¸¸å¤§çš„æ¶ˆæ¯è¿›è¡Œæ‰¹é‡æ¶ˆè´¹ï¼Œè€Œä¸ä¼šæ”¶åˆ°å¤šæ¡æ¶ˆæ¯ã€‚

**æ‰¹é‡å‘é€æ¡ä»¶**
ä½¿ç”¨BatchingRabbitTemplateæ¥æ›¿ä»£RabbitTemplateï¼Œæ»¡è¶³ä»¥ä¸‹ä»»æ„æ¡ä»¶åˆ™ä¼šæ‰¹é‡å‘é€ï¼š
1.  æ•°é‡batchSize ï¼šè¶…è¿‡æ”¶é›†çš„æ¶ˆæ¯æ•°é‡çš„æœ€å¤§æ¡æ•°ã€‚
2.  ç©ºé—´bufferLimit ï¼šè¶…è¿‡æ”¶é›†çš„æ¶ˆæ¯å ç”¨çš„æœ€å¤§å†…å­˜ã€‚
3.  æ—¶é—´timeout ï¼šè¶…è¿‡æ”¶é›†çš„æ—¶é—´çš„æœ€å¤§ç­‰å¾…æ—¶é•¿ï¼Œå•ä½æ¯«ç§’ã€‚ğŸ˜ˆ ä¸è¿‡è¦æ³¨æ„ï¼Œè¿™é‡Œçš„è¶…æ—¶å¼€å§‹è®¡æ—¶çš„æ—¶é—´ï¼Œæ˜¯ä»¥æœ€åä¸€æ¬¡å‘é€æ—¶é—´ä¸ºèµ·ç‚¹ã€‚ä¹Ÿå°±è¯´ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡å‘é€æ¶ˆæ¯ï¼Œéƒ½ä»¥å½“å‰æ—¶åˆ»å¼€å§‹è®¡æ—¶ï¼Œé‡æ–°åˆ°è¾¾ timeout æ¯«ç§’æ‰ç®—è¶…æ—¶ã€‚
æ³¨æ„ï¼šæ€§èƒ½å¹¶ä¸å¥½ã€‚å¯¹äºåŒä¸€ä¸ª BatchingRabbitTemplate å¯¹è±¡æ¥è¯´ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ‰¹æ¬¡(ä¿è¯ Exchange + RoutingKey ç›¸åŒ)ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

**åˆ›å»ºè‡ªå®šä¹‰BatchRabbitTemplate**
==@Bean==
public BatchingRabbitTemplate batchRabbitTemplate(ConnectionFactory connectionFactory) {
// åˆ›å»º BatchingStrategy å¯¹è±¡ï¼Œä»£è¡¨æ‰¹é‡ç­–ç•¥
int batchSize = 200; // è¶…è¿‡æ”¶é›†çš„æ¶ˆæ¯æ•°é‡çš„æœ€å¤§æ¡æ•°ã€‚
int bufferLimit = 33554432; // æ¯æ¬¡æ‰¹é‡å‘é€æ¶ˆæ¯çš„æœ€å¤§å†…å­˜
int timeout = 6000; // è¶…è¿‡æ”¶é›†çš„æ—¶é—´çš„æœ€å¤§ç­‰å¾…æ—¶é•¿ï¼Œå•ä½ï¼šæ¯«ç§’
BatchingStrategy batchingStrategy = new SimpleBatchingStrategy(batchSize, bufferLimit, timeout);

// åˆ›å»º TaskScheduler å¯¹è±¡ï¼Œç”¨äºå®ç°è¶…æ—¶å‘é€çš„å®šæ—¶å™¨
TaskScheduler taskScheduler = new ConcurrentTaskScheduler();

// åˆ›å»º BatchingRabbitTemplate å¯¹è±¡
BatchingRabbitTemplate batchTemplate = new BatchingRabbitTemplate(batchingStrategy, taskScheduler);
batchTemplate.setConnectionFactory(connectionFactory);
return batchTemplate;
}
