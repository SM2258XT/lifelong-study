---
title: 流控效果：失败 预热 排队
updated: 2022-02-02T08:40:56
created: 2022-02-01T22:12:21
---

流控效果：失败 预热 排队
![](C:\Users\82609\AppData\Local\Temp\Java\pandoc/media/image1.png)
2022年2月1日
22:12

1.  快速失败：直接报错抛异常
2.  预热：
当流量突然增大的时候（如秒杀服务），我们常常会希望系统从空闲状态到繁忙状态的切换的时间长一些。即如果系统在此之前长期处于空闲的状态，我们希望处理请求的数量是缓步增多，经过预期的时间以后，到达系统处理请求个数的最大值。Warm Up（冷启动，预热）模式就是为了实现这个目的。

**默认 coldFactor 为 3**，即请求 QPS 从 threshold / 3 开始，经预热时长逐渐升至设定的 QPS 阈值。

右图1：最开始每秒访问量限制为 10 / 3 = 3 ，然后在5秒之内慢慢恢复为最大10
1.  排队等待
严格控制请求通过的间隔时间，也即是让请求以均匀的速度通过，对应的是漏桶算法。阈值必须设置为QPS。

右图2：QPS为2时的排队等待效果

![](C:\Users\82609\AppData\Local\Temp\Java\pandoc/media/image2.png)
