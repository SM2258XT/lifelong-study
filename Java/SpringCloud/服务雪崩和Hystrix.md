---
title: 服务雪崩和Hystrix
updated: 2021-10-04T10:25:41
created: 2021-10-03T09:16:34
---

服务雪崩和Hystrix
2021年10月3日
9:16

1.  服务雪崩
    - 多个微服务之间调用的时候，假设微服务A调用微服务B和微服务C，微服务B和微服务C又调用其它的微服务，这就是所谓的“扇出”。
如果扇出的链路上某个微服务的调用响应时间过长或者不可用，对微服务A的调用就会占用越来越多的系统资源，进而引起系统崩溃，即所谓的“雪崩效应”
1.  简而言之：一个服务失败，导致整条链路的服务都失败的情形，我们称之为服务雪崩。
1.  引起服务雪崩的原因和三个阶段：
1、硬件故障；

2、程序Bug；

3、缓存击穿（用户大量访问缓存中没有的键值，导致大量请求查询数据库，使数据库压力过大）；

4、用户大量请求；

第一阶段：服务不可用；

第二阶段：调用端重试加大流量（用户重试/代码逻辑重试）；

第三阶段：服务调用者不可用（同步等待造成的资源耗尽）；
1.  服务熔断、服务降级、服务限流
什么是服务熔断？
1.  当下游的服务因为某种原因突然变得不可用或响应过慢，上游服务为了保证自己整体服务的可用性，不再继续调用目标服务，直接返回，快速释放资源。如果目标服务情况好转则恢复调用。
2.  业内普遍采用断路器模式。当远程服务被调用时，断路器将监视这个调用，如调用时间太长，断路器将会介入并中断调用。此外，断路器将监视所有对远程资源的调用，如对某一个远程资源的调用失败次数足够多，那么断路器会出现并采取快速失败，阻止将来调用此远程资源的请求。
什么是服务降级？

服务降级主要有两种场景：
1.  当下游的服务因为某种原因响应过慢，下游服务主动停掉一些不太重要的业务，释放出服务器资源，增加响应速度！
2.  当下游的服务因为某种原因不可用，上游主动调用本地的一些降级逻辑，避免卡顿，迅速返回给调用者！服务熔断可视为降级方式的一种！
什么是服务限流？

限时秒杀等高并发操作，如果服务出现了异常，则进行服务限流：严禁一窝蜂过来拥挤，限定一秒钟只能调用最多N次，有序进行。
1.  什么是Hystrix
    - Hystrix是一个用于处理分布式系统的延迟和容错的开源库，在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等，Hystrix能够保证在一个依赖出问题的情况下，不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性。
    - "断路器”本身是一种开关装置，当某个服务单元发生故障之后，通过断路器的故障监控（类似熔断保险丝)，向调用方返回一个符合预期的、可处理的备选响应（FallBack)，而不是长时间的等待或者抛出调用方无法处理的异常，这样就保证了服务调用方的线程不会被长时间、不必要地占用，从而避免了故障在分布式系统中的蔓延，乃至雪崩。

![](C:\Users\82609\AppData\Local\Temp\Java\pandoc/media/image1.png)
